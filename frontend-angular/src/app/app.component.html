<div class="miniml-container">
  <!-- Header -->
  <header class="header">
    <div class="title-section">
      <h1>MiniML - Predictive Quality Control</h1>
      <p class="subtitle">Simplified Frontend</p>
    </div>
    <div class="logo">
      <div class="abb-logo">ABB</div>
    </div>
  </header>

  <!-- Step Progress Indicator -->
  <div class="step-indicator">
    <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1" (click)="goToStep(1)">
      <div class="step-number">1</div>
      <div class="step-label">Upload Dataset</div>
    </div>
    <div class="step-line"></div>
    <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2" (click)="goToStep(2)">
      <div class="step-number">2</div>
      <div class="step-label">Date Ranges</div>
    </div>
    <div class="step-line"></div>
    <div class="step" [class.active]="currentStep === 3" [class.completed]="currentStep > 3" (click)="goToStep(3)">
      <div class="step-number">3</div>
      <div class="step-label">Model Training</div>
    </div>
    <div class="step-line"></div>
    <div class="step" [class.active]="currentStep === 4" [class.completed]="currentStep > 4" (click)="goToStep(4)">
      <div class="step-number">4</div>
      <div class="step-label">Simulation</div>
    </div>
  </div>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Screen 1: Upload Dataset -->
    <div *ngIf="currentStep === 1">
      <div class="step-header">
        <h2>Upload Dataset</h2>
        <span class="step-counter">Step {{ currentStep }} of 4</span>
      </div>

      <!-- Upload Section -->
      <div class="upload-section">
        <div class="upload-card" 
             [class.has-file]="uploadedFile"
             [class.drag-over]="isDragOver"
             (dragover)="onDragOver($event)"
             (dragleave)="onDragLeave($event)"
             (drop)="onDrop($event)"
             (click)="fileInput.click()">
          
          <input #fileInput type="file" accept=".csv" (change)="onFileSelected($event)" style="display: none;">
          
          <div *ngIf="!uploadedFile && !isProcessing" class="upload-placeholder">
            <div class="csv-icon">ðŸ“„</div>
            <p class="upload-text">Click to select a CSV file or drag and drop</p>
            <button class="choose-file-btn">Choose File</button>
          </div>

          <div *ngIf="isProcessing" class="processing-placeholder">
            <div class="spinner"></div>
            <p class="processing-text">Processing your CSV file...</p>
          </div>

          <div *ngIf="uploadedFile" class="uploaded-file">
            <div class="metadata-summary" *ngIf="fileMetadata">
              <div class="metadata-cards">
                <!-- CSV File Card -->
                <div class="metadata-card">
                  <div class="card-icon">ðŸ“„</div>
                  <div class="card-content">
                    <div class="card-title">CSV File</div>
                    <div class="file-name" (click)="downloadFile()">{{ uploadedFile?.name }}</div>
                    <div class="file-size">{{ formatFileSize(uploadedFile?.size || 0) }}</div>
                  </div>
                </div>
                
                <!-- Records Card -->
                <div class="metadata-card">
                  <div class="card-icon">ðŸ“Š</div>
                  <div class="card-content">
                    <div class="card-title">Records</div>
                    <div class="card-value">{{ formatNumber(fileMetadata?.totalRecords || 0) }}</div>
                  </div>
                </div>
                
                <!-- Columns Card -->
                <div class="metadata-card">
                  <div class="card-icon">ðŸ“‹</div>
                  <div class="card-content">
                    <div class="card-title">Columns</div>
                    <div class="card-value">{{ fileMetadata?.totalColumns || 0 }}</div>
                  </div>
                </div>
                
                <!-- Pass Rate Card -->
                <div class="metadata-card">
                  <div class="card-icon">âœ…</div>
                  <div class="card-content">
                    <div class="card-title">Pass Rate</div>
                    <div class="card-value pass-rate">{{ fileMetadata?.passRate || 0 }}%</div>
                  </div>
                </div>
                
                <!-- Date Range Card -->
                <div class="metadata-card">
                  <div class="card-icon">ðŸ“…</div>
                  <div class="card-content">
                    <div class="card-title">Date Range</div>
                    <div class="card-value">{{ fileMetadata?.dateRange || '' }}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <div class="navigation">
        <button class="next-btn" 
                [disabled]="!fileMetadata || isProcessing"
                (click)="nextStep()">
          Next
        </button>
      </div>
    </div>

    <!-- Screen 2: Date Ranges -->
    <div *ngIf="currentStep === 2">
      <div class="step-header">
        <h2>Date Ranges</h2>
        <span class="step-counter">Step {{ currentStep }} of 4</span>
      </div>

      <div class="date-ranges-section">
        <!-- Training Period -->
        <div class="period-card">
          <h3>Training Period</h3>
          <div class="date-inputs">
            <div class="date-input">
              <label>Start Date</label>
              <input type="date" [(ngModel)]="trainingStart">
            </div>
            <div class="date-input">
              <label>End Date</label>
              <input type="date" [(ngModel)]="trainingEnd">
            </div>
          </div>
        </div>

        <!-- Testing Period -->
        <div class="period-card">
          <h3>Testing Period</h3>
          <div class="date-inputs">
            <div class="date-input">
              <label>Start Date</label>
              <input type="date" [(ngModel)]="testingStart">
            </div>
            <div class="date-input">
              <label>End Date</label>
              <input type="date" [(ngModel)]="testingEnd">
            </div>
          </div>
        </div>

        <!-- Simulation Period -->
        <div class="period-card">
          <h3>Simulation Period</h3>
          <div class="date-inputs">
            <div class="date-input">
              <label>Start Date</label>
              <input type="date" [(ngModel)]="simulationStart">
            </div>
            <div class="date-input">
              <label>End Date</label>
              <input type="date" [(ngModel)]="simulationEnd">
            </div>
          </div>
        </div>

        <!-- Validation -->
        <div class="validation-section">
          <button class="validate-btn" (click)="validateDateRanges()">Validate Ranges</button>
          <div class="validation-message" [class.valid]="dateRangesValid" [class.invalid]="!dateRangesValid && dateValidationMessage">
            <span *ngIf="dateValidationMessage">{{ dateValidationMessage }}</span>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <div class="navigation">
        <button class="prev-btn" (click)="previousStep()">Previous</button>
        <button class="next-btn" 
                [disabled]="!dateRangesValid"
                (click)="nextStep()">
          Next
        </button>
      </div>
    </div>

    <!-- Screen 3: Model Training -->
    <div *ngIf="currentStep === 3">
      <div class="step-header">
        <h2>Model Training & Evaluation</h2>
        <span class="step-counter">Step {{ currentStep }} of 4</span>
      </div>

      <div class="training-section">
        <button class="train-btn" 
                [disabled]="isTraining"
                (click)="trainModel()">
          <span *ngIf="!isTraining">Train Model</span>
          <span *ngIf="isTraining">Training...</span>
        </button>

        <div *ngIf="modelTrained && trainingMetrics" class="training-results">
          <h3>Model Performance</h3>
          <div class="metrics-grid">
            <div class="metric-card">
              <div class="metric-value">{{ trainingMetrics.accuracy }}%</div>
              <div class="metric-label">Accuracy</div>
            </div>
            <div class="metric-card">
              <div class="metric-value">{{ trainingMetrics.precision }}%</div>
              <div class="metric-label">Precision</div>
            </div>
            <div class="metric-card">
              <div class="metric-value">{{ trainingMetrics.recall }}%</div>
              <div class="metric-label">Recall</div>
            </div>
            <div class="metric-card">
              <div class="metric-value">{{ trainingMetrics.f1Score }}%</div>
              <div class="metric-label">F1-Score</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <div class="navigation">
        <button class="prev-btn" (click)="previousStep()">Previous</button>
        <button class="next-btn" 
                [disabled]="!modelTrained"
                (click)="nextStep()">
          Next
        </button>
      </div>
    </div>

    <!-- Screen 4: Simulation -->
    <div *ngIf="currentStep === 4">
      <div class="step-header">
        <h2>Real-Time Prediction Simulation</h2>
        <span class="step-counter">Step {{ currentStep }} of 4</span>
      </div>

      <div class="simulation-section">
        <div class="simulation-controls">
          <button class="simulation-btn" 
                  [disabled]="simulationRunning"
                  (click)="simulationComplete ? restartSimulation() : startSimulation()">
            <span *ngIf="!simulationComplete && !simulationRunning">Start Simulation</span>
            <span *ngIf="simulationRunning">Running...</span>
            <span *ngIf="simulationComplete && !simulationRunning">Restart Simulation</span>
          </button>
          
          <div *ngIf="simulationComplete" class="simulation-status">
            <span class="status-icon">âœ”</span>
            <span class="status-text">Simulation completed</span>
          </div>
        </div>

        <div *ngIf="simulationStats" class="simulation-stats">
          <div class="stat-card">
            <div class="stat-value">{{ simulationStats.totalPredictions }}</div>
            <div class="stat-label">Total Predictions</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ simulationStats.passCount }}</div>
            <div class="stat-label">Pass Count</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ simulationStats.failCount }}</div>
            <div class="stat-label">Fail Count</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ simulationStats.averageConfidence }}%</div>
            <div class="stat-label">Average Confidence</div>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <div class="navigation">
        <button class="prev-btn" (click)="previousStep()">Previous</button>
        <button class="complete-btn" [disabled]="!simulationComplete">Complete</button>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-left">MiniML POC</div>
    <div class="footer-right">ENGINEERED TO OUTRUN</div>
  </footer>
</div>